# Capability: explanation-generation

答案解析生成：从统一题目文本出发，生成分步文字解析，并为每个步骤生成一张对应讲解图；支持图片先识图转为题目文本。

## ADDED Requirements

### Requirement: 图片题目先转为题目文本

当输入为图片时，系统 SHALL 先通过识图（多模态或 OCR）将图片转为题目文本；公式部分 SHALL 以 LaTeX 形式输出，以保证后续全链路公式一致。

#### Scenario: 上传图片后的识图流程

- **WHEN** 用户提交题目图片并触发解析
- **THEN** 系统先调用识图能力得到题目文本（含 LaTeX 公式），再基于该文本进行解析生成

#### Scenario: 识图输出用于解析

- **WHEN** 识图成功返回题目文本
- **THEN** 该文本作为唯一题目来源传入解析生成流水线，与用户直接输入文字时使用同一套解析逻辑

### Requirement: 生成分步文字解析

系统 SHALL 基于题目文本生成分步文字解析。解析结构 SHALL 为步骤序列，每步包含可展示的标题/简述与正文；正文中的数学公式 SHALL 以 LaTeX 表示。

#### Scenario: 解析结果包含多步

- **WHEN** 解析生成成功
- **THEN** 返回的解析数据 SHALL 包含至少一个步骤，每步 SHALL 包含该步的文字内容（含 LaTeX 公式）

#### Scenario: 步骤顺序与逻辑一致

- **WHEN** 用户查看解析结果
- **THEN** 步骤顺序 SHALL 与解题逻辑一致，便于按序阅读

### Requirement: 每步生成一张对应讲解图

系统 SHALL 为解析中的每个步骤生成一张讲解图，且每张图 SHALL 与对应步骤唯一绑定；多张图与步骤一一对应。

#### Scenario: 步骤与图片数量对应

- **WHEN** 解析生成完成
- **THEN** 步骤数量与讲解图数量 SHALL 一致，且第 N 张图对应第 N 个步骤

#### Scenario: 图片与步骤语义对应

- **WHEN** 后端生成某步骤的讲解图
- **THEN** 该图内容 SHALL 基于该步骤的解析内容生成，用于辅助理解该步

### Requirement: 不限制题型

系统 SHALL 支持各类数学题型（如代数、几何、应用题等），不在首版限制题型；首版配图以模型生成方式为主。

#### Scenario: 不同题型均可提交

- **WHEN** 用户提交任意数学题目（代数、几何、应用题等）
- **THEN** 系统 SHALL 尝试生成分步解析与步骤对应讲解图，不因题型拒绝请求

### Requirement: 公式以 LaTeX 全链路表示

解析与配图流程中，所有数学公式 SHALL 以 LaTeX 形式表示与传递；生成文本与结构化数据中 SHALL 不依赖非 LaTeX 的公式编码，以避免乱码与不一致。

#### Scenario: 解析文本中的公式格式

- **WHEN** 大模型输出解析内容
- **THEN** 公式部分 SHALL 以 LaTeX 语法输出（如行内 `$...$` 或块级 `$$...$$`），供前端统一渲染
